# Bridge Chloride Exposure Predictor

Developer Names: Cynthia Liu, Spencer Smith

Theory support: Mingsai Xu

Date of project start: January 19, 2024

This project is intended to investigate how climate, traffic might impact corrosion-induced damage for reinforced concrete bridges by influencing the chloride exposure.


The folders and files for this project are as follows:
```
.
├── data
│   ├── boundary.json # boundary of jurisdiction in which software inputs are defined
│   ├── data.xlsx     # traffic model and climate model
├── docs                   
│   ├── Checklists
|   ├── Design
│   |   ├── SoftArchitecture
│   │   └── SoftDetailedDes 
│   ├── Presentations                                
│   ├── ProblemStatementAndGoals
│   ├── Reflection                                
│   ├── SRS                
│   ├── VnVPlan         
│   └── VnVReport                
├── paper
│── src          
|   ├── database      # code for generating the database 
|   └── web           # code for user side of the software
│       ├── public    # files generated from database
│       └── src       # code for the website
│── Makefile          # quick start commands
└── requirements.txt  # dependencies
```
## Set Up

### Python
This databse for this project is generated by Python. To install Python in windows, simply download the release from [here](https://www.python.org/downloads/windows/) and follow the install instructions.\
To install Python on mac, you can download the release from [here](https://www.python.org/downloads/macos/).

### Python Virtual Environment (Recommended)
To avoid dependency conflicts, it is recommended to use a Python virtual environment
1. Create the virtual environment in the project root:
`python -m venv venv`

    This will create a venv directory containing an isolated Python environment for this project.

2. Activate the virtual environment

    On macOS / Linux:  `source venv/bin/activate`

    On Windows (PowerShell):  `venv\Scripts\Activate.ps1`

    If you encounter an execution policy error in PowerShell, you may need to run:
    `Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser`

After activation, your terminal prompt should be prefixed with `(venv)`.

### Node and npm
Node.js provides a JavaScript runtime environment to execute the JavaScript code outside of a web browser.  Npm is the package manager for Node.

To install node in Windows using the [Installer](https://nodejs.org/en/download).  To install on a Mac, use the [Installer](https://nodejs.org/en/download) or `brew install node`.

### Vue
The web interface is built using Vue and its dependencies are installed locally via npm.
No global Vue installation is required.

### Make
This project use [make](https://www.gnu.org/software/make/manual/make.html#Overview) as an access for running the software. 

To install make in Windows, you can do 
`winget install ezwinports.make` in PowerShell. \
To install make in mac, do `brew install make` if you have [Homebrew](https://brew.sh/) installed. It is also available in other package managers. \
After installation, restart PowerShell or Terminal to make it work.

## How to Start

1. Open the command line terminal (for mac) or PowerShell (for windows).
2. Clone this repo via `git clone` in your folder of choice
3. `cd` into the repo (`BridgeChlorideExposurePredictor` by default)
3. Activate the Python virtual environment following the procedure above in [Python Setup](#python-virtual-environment-recommended).
4. Do `make requirements` in the root folder of this repo to install the libraries and dependencies.
5. Do `make database` to generate the chloride exposure database.
6. Do `make web` to run the software on the local machine. 
7. You should see the message from terminal saying that the software is running successfully in localhost. Usually it is http://127.0.0.1:5000 but it might differ on your machine.

### Alternative ways to run
If the above method does not work, you can try the following in the root folder of this repo:
```
python src/database/calculation.py
cd src/web && npm run serve
```
Then the software should be running in localhost.


Notes: In some Python versions, you might need to run python3 instead of python to run the app. That is:
```
python3 src/database/calculation.py
cd src/web && npm run serve
```

## Usage
#### Input Longitude and Latitude
Users can provide longitude and latitude by either entering the numeric values directly into the text boxes or by clicking on a point within the specified jurisdiction on the map.

#### View the Data
Once the coordinates are entered, the corresponding data for the selected location will be displayed below. Additionally, a visualization is provided to offer further insights.

#### Download data
Users have the option to download the data for further analysis. The data is presented in a csv format with the year and corresponding value aligned vertically. Each row represents a specific year, while the columns display the year and its associated value for clear and concise representation.

## Quit
Press `Command+ C` in terminal and `Ctrl + C` in PowerShell to quit the software.

To exit your virtual environment enter `deactivate` at the terminal prompt.

## Change for a Different Jurisdiction

To apply this model to a different jurisdiction or to a different grid resolution, no changes to the core calculation code are required. Instead, the following inputs must be updated.

### 1. data.xlsx

Replace the contents of `data/data.xlsx` with region-specific data. 

- All sheets (traffic, t1, t2, htotal) must have the same number of rows, see below for details.
- Each row across all sheets must correspond to the same grid cell. The model does not assume a fixed grid size; the grid definition is implicitly determined by the input data.


### 1.1 `traffic` Sheet

Traffic characteristics for each grid cell.

**Required columns:**
| Column | Field     | Description                            |
| ------ | --------- | -------------------------------------- |
| **A**  | Longitude | Geographic longitude of the grid point |
| **B**  | Latitude  | Geographic latitude of the grid point  |
| **C**  | City      | City or location name                  |
| **D**  | AADT/lane      | Annual Average Daily Traffic           |
| **E**  | AADTT/lane     | Annual Average Daily Truck Traffic     |


**Example layout:**
|LON        |LAT        |CITY   |AADT/lane	|AADTT/lane|
|---        | ---       |---    |---        |---       |
|274.712677	|49.45780945|Algoma |559        |103       |
|274.7636414|49.67531204|Algoma |559        |103       |
|  ...      | ...       | ...   | ...       | ...      |
---


### 1.2 `t1` Sheet

Number of snow or ice days per year for each grid cell.

**Required columns:**
| Column | Field     | Description                            |
| ------ | --------- | -------------------------------------- |
| **A**  | Grid cell identifier | Each row corresponds to a grid cell (aligned with `traffic` sheet) |
| **B, C, …**  | Year columns (e.g., 2005, 2006, 2007, …) | Number of snow or ice days in that year for the grid cell  |
---

**Example layout:**
| Year | 2006 | 2007 | 2008 | ... |
| ---- | ---- | ---- | ---- | --- |
|      | 106  | 125  | 96   | ... |
|      | 105  | 122  | 93   | ... |
|      | 103  | 91   | 78   | ... |
|      | ...  | ...  | ...  | ... |
---


### 1.3 `t2` Sheet

Number of snow-melting days per year for each grid cell.


**Required columns:**
| Column | Field     | Description                            |
| ------ | --------- | -------------------------------------- |
| **A**  | Grid cell identifier | Each row corresponds to a grid cell (aligned with `traffic` sheet) |
| **B, C, …**  | Year columns (e.g., 2005, 2006, 2007, …) | Number of snow-melting days in that year for the grid cell  |
---

**Example layout:**
| Year | 2006 | 2007 | 2008 | ... |
| ---- | ---- | ---- | ---- | --- |
|      | 76   | 61   | 104  | ... |
|      | 76   | 64   | 97   | ... |
|      | 87   | 89   | 101  | ... |
|      | ...  | ...  | ...  | ... |
---


### 1.4 `htotal` Sheet

| Column      | Field                                    | Description                                                        |
| ----------- | ---------------------------------------- | ------------------------------------------------------------------ |
| **A**       | Grid cell identifier                     | Each row corresponds to a grid cell (aligned with `traffic` sheet) |
| **B, C, …** | Year columns (e.g., 2005, 2006, 2007, …) | Total snow depth (cm) in that year for the grid cell               |

**Example layout:**
| Year | 2006       | 2007      | 2008      | ... |
| ---- | ----       | ----      | ----      | --- |
|      | 206.2145241|220.8943212|121.5795313| ... |
|      | 211.174729 |221.0476551|137.5310097| ... |
|      | 165.2436496|239.4575019|130.4865169| ... |
|      | ...        | ...       | ...       | ... |
---


The model does not assume a fixed grid size; the grid definition is implicitly determined by the input data.

### 2. boundary.json
Replace the contents of `data/boundary.json` with one representing the new jurisdiction

This boundary is used to check whether a grid cell belongs to the study area and may also affect visualization or filtering steps.